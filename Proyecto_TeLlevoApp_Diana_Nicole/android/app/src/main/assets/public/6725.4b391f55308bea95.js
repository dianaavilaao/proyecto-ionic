"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6725],{6725:(T,m,s)=>{s.r(m),s.d(m,{SelectedServicePageModule:()=>R});var h=s(177),u=s(4341),n=s(791),g=s(70),p=s(467),e=s(3953),S=s(3656),f=s(3067);const j=["map"],M=[{path:"",component:(()=>{var o;class l{constructor(t,a,i,r,c){this.navController=t,this.toastController=a,this.route=i,this.cdr=r,this.loginService=c,this.direccionDestino="",this.sedeLatLng=null,this.servicioSeleccionado=null,this.distanciaRuta=0,this.puedeAceptarViaje=!1,this.sedesCoordenadas={alameda:{lat:-33.448811744328104,lng:-70.67000634086763},"padre-alonso":{lat:-33.44682566206291,lng:-70.65790159815451},"antonio-varas":{lat:-33.44068250885547,lng:-70.61310785582465},"educacion-continua":{lat:-33.44094340384291,lng:-70.64136448465972},maipu:{lat:-33.51108930945361,lng:-70.75242783014274},melipilla:{lat:-33.694007463538455,lng:-71.21363605897166},"plaza-norte":{lat:-33.36325179825936,lng:-70.67806718597237},"plaza-oeste":{lat:-33.515031677647414,lng:-70.71841127431784},vespucio:{lat:-33.5158878754339,lng:-70.59814927916166},"puente-alto":{lat:-33.59837125344353,lng:-70.57875488465972},"san-bernardo":{lat:-33.59875879098744,lng:-70.70576867246973},"san-carlos":{lat:-33.400101350316945,lng:-70.50550904364131},"san-joaquin":{lat:-33.50006728013748,lng:-70.61648592218478},valparaiso:{lat:-33.044326091862054,lng:-71.61526329763237},"vina-del-mar":{lat:-33.0336442009385,lng:-71.53315191666383},arauco:{lat:-37.24702962406319,lng:-73.29512711651584},nacimiento:{lat:-37.510110951624355,lng:-72.66152531534028},"san-andres":{lat:-36.795107594505424,lng:-73.06259426070766},villarrica:{lat:-39.27738652083515,lng:-72.22425840294416},"puerto-montt":{lat:-41.47002231927331,lng:-72.92580857402234}}}ngAfterViewInit(){this.inicializarMapa(),this.route.queryParams.subscribe(t=>{if(t.servicio){var a;this.servicioSeleccionado=JSON.parse(t.servicio);const i=null===(a=this.servicioSeleccionado)||void 0===a?void 0:a.sede;i&&this.sedesCoordenadas[i]?(this.sedeLatLng=this.sedesCoordenadas[i],this.map.setCenter(this.sedeLatLng),this.map.setZoom(15)):this.mostrarToast("Sede no v\xe1lida","danger")}})}volver(){this.navController.back()}inicializarMapa(){const t={center:{lat:-33.45694,lng:-70.64827},zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(this.mapElement.nativeElement,t),this.geocoder=new google.maps.Geocoder,this.directionsService=new google.maps.DirectionsService,this.directionsRenderer=new google.maps.DirectionsRenderer,this.directionsRenderer.setMap(this.map)}aceptarDireccion(){var t=this;return(0,p.A)(function*(){t.direccionDestino?t.sedeLatLng?t.geocoder.geocode({address:t.direccionDestino},(a,i)=>{i===google.maps.GeocoderStatus.OK?t.mostrarRuta(a[0].geometry.location):t.mostrarToast("No se pudo encontrar la direcci\xf3n","danger")}):t.mostrarToast("No se ha configurado una sede v\xe1lida","danger"):t.mostrarToast("Por favor ingresa una direcci\xf3n v\xe1lida","danger")})()}mostrarRuta(t){const a={origin:this.sedeLatLng,destination:t,travelMode:google.maps.TravelMode.DRIVING};this.directionsService.route(a,(i,r)=>{if(r===google.maps.DirectionsStatus.OK){var c;this.directionsRenderer.setDirections(i),this.distanciaRuta=i.routes[0].legs[0].distance.value/1e3;const v=(null===(c=this.servicioSeleccionado)||void 0===c?void 0:c.distanciaMaxima)||0;this.puedeAceptarViaje=v>0&&this.distanciaRuta<=v,this.cdr.detectChanges(),this.mostrarToast(`Distancia hasta el destino: ${this.distanciaRuta.toFixed(2)} km`,"medium")}else this.mostrarToast("No se pudo calcular la ruta","danger")})}mostrarToast(t,a){var i=this;return(0,p.A)(function*(){(yield i.toastController.create({message:t,duration:3e3,position:"bottom",color:a})).present()})()}aceptarViaje(){var t=this;return(0,p.A)(function*(){if(!t.servicioSeleccionado)return void t.mostrarToast("No se encontr\xf3 el servicio seleccionado.","danger");const a=t.servicioSeleccionado.distanciaMaxima||0;if(t.puedeAceptarViaje){const i=t.servicioSeleccionado.vehiculo;i.capacidadMaxima>i.asientosOcupados?(i.asientosOcupados+=1,yield t.loginService.actualizarServicio(t.servicioSeleccionado),t.mostrarToast("\xa1Viaje aceptado exitosamente!","success")):t.mostrarToast("No hay asientos disponibles para este viaje.","danger")}else t.mostrarToast(t.distanciaRuta>a?`No puedes tomar este viaje. La distancia (${t.distanciaRuta.toFixed(2)} km) supera el l\xedmite permitido por el conductor.`:"No es posible aceptar el viaje. Verifica la distancia.","danger")})()}}return(o=l).\u0275fac=function(t){return new(t||o)(e.rXU(S.q9),e.rXU(n.K_),e.rXU(g.nX),e.rXU(e.gRc),e.rXU(f.H))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-selected-service"]],viewQuery:function(t,a){if(1&t&&e.GBs(j,5),2&t){let i;e.mGM(i=e.lsd())&&(a.mapElement=i.first)}},decls:19,vars:3,consts:[["search",""],["map",""],["slot","start"],[3,"click"],["name","arrow-back-outline"],["position","floating"],["type","text",3,"ngModelChange","ngModel"],["expand","block",3,"click"],["id","map",2,"height","50vh","margin-top","10px"],["expand","block",3,"click","disabled","color"]],template:function(t,a){if(1&t){const i=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2)(3,"ion-button",3),e.bIt("click",function(){return e.eBV(i),e.Njj(a.volver())}),e.nrm(4,"ion-icon",4),e.k0s()(),e.j41(5,"ion-title"),e.EFF(6,"Toma un viaje"),e.k0s()()(),e.j41(7,"ion-content")(8,"ion-item")(9,"ion-label",5),e.EFF(10,"Ingrese su direcci\xf3n destino"),e.k0s(),e.j41(11,"ion-input",6,0),e.mxI("ngModelChange",function(c){return e.eBV(i),e.DH7(a.direccionDestino,c)||(a.direccionDestino=c),e.Njj(c)}),e.k0s()(),e.j41(13,"ion-button",7),e.bIt("click",function(){return e.eBV(i),e.Njj(a.aceptarDireccion())}),e.EFF(14,"Aceptar"),e.k0s(),e.nrm(15,"div",8,1),e.j41(17,"ion-button",9),e.bIt("click",function(){return e.eBV(i),e.Njj(a.aceptarViaje())}),e.EFF(18," Aceptar viaje\n"),e.k0s()()}2&t&&(e.R7$(11),e.R50("ngModel",a.direccionDestino),e.R7$(6),e.Y8G("disabled",!a.puedeAceptarViaje)("color",a.puedeAceptarViaje?"primary":"medium"))},dependencies:[u.BC,u.vS,n.Jm,n.QW,n.W9,n.eU,n.iq,n.$w,n.uz,n.he,n.BC,n.ai,n.Gw],styles:["#map[_ngcontent-%COMP%]{width:100%;height:400px}"]}),l})()}];let P=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[g.iI.forChild(M),g.iI]}),l})(),R=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[h.MD,u.YN,n.bv,P]}),l})()}}]);