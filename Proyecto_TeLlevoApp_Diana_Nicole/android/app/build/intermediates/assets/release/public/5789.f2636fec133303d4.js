"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5789],{5789:($,v,s)=>{s.r(v),s.d(v,{ServiceStatusPageModule:()=>P});var u=s(177),m=s(4341),n=s(791),p=s(70),d=s(467),e=s(3953),S=s(3067),g=s(3656);function h(a,r){if(1&a&&(e.j41(0,"ion-item",8),e.nrm(1,"ion-icon",9),e.j41(2,"ion-label"),e.EFF(3),e.j41(4,"p"),e.EFF(5),e.k0s()()()),2&a){const t=r.$implicit;e.R7$(),e.Y8G("name",t.acepto?"checkmark-circle":"time")("color",t.acepto?"success":"warning"),e.R7$(2),e.SpI(" ",t.usuario," "),e.R7$(2),e.JRh(t.acepto?"Aceptado":"Pendiente")}}function j(a,r){if(1&a){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-label")(2,"h2"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s(),e.j41(8,"p"),e.EFF(9),e.nI1(10,"number"),e.k0s(),e.j41(11,"div",5)(12,"h3"),e.EFF(13),e.k0s(),e.j41(14,"ion-list"),e.DNE(15,h,6,4,"ion-item",6),e.k0s()()(),e.j41(16,"ion-button",7),e.bIt("click",function(){const o=e.eBV(t).$implicit,c=e.XpG();return e.Njj(c.confirmarInicioViaje(o))}),e.EFF(17),e.k0s()()}if(2&a){const t=r.$implicit;e.R7$(3),e.SpI("Sede: ",t.sede,""),e.R7$(2),e.Lme("Veh\xedculo: ",t.vehiculo.marca," ",t.vehiculo.modelo,""),e.R7$(2),e.Lme("Capacidad ocupada: ",t.vehiculo.asientosOcupados," de ",t.vehiculo.capacidadMaxima,""),e.R7$(2),e.SpI("Tiempo restante: ",e.i5U(10,10,t.tiempoRestante,"1.0-0")," minutos"),e.R7$(4),e.SpI("Pasajeros (",t.pasajeros.length,")"),e.R7$(2),e.Y8G("ngForOf",t.pasajeros),e.R7$(),e.Y8G("disabled",!t.todosAceptaron||0===t.pasajeros.length),e.R7$(),e.SpI(" ",t.todosAceptaron?"Iniciar Viaje":"Esperando aceptaci\xf3n"," ")}}function f(a,r){1&a&&(e.j41(0,"ion-text",10)(1,"p"),e.EFF(2,"No tienes servicios activos."),e.k0s()())}const F=[{path:"",component:(()=>{var a;class r{constructor(i,o,c){this.loginService=i,this.navController=o,this.alertController=c,this.servicios=[],this.serviciosUsuario=[]}ngOnInit(){var i=this;return(0,d.A)(function*(){yield i.cargarServiciosUsuario()})()}volver(){this.navController.back()}filtrarServiciosActivos(){const i=Date.now();this.serviciosUsuario=this.servicios.filter(o=>o.conductor.usuario===this.usuarioAutenticado.usuario).map(o=>{const c=o.minutosAnuncio-(i-o.id)/6e4,l=o.vehiculo.capacidadMaxima||0,R=o.vehiculo.asientosOcupados||0;o.pasajeros=o.pasajeros||[];const k=o.pasajeros.every(I=>I.acepto);return{...o,tiempoRestante:Math.max(c,0),capacidadMaxima:l,asientosOcupados:R,todosAceptaron:k}}).filter(o=>o.tiempoRestante>0)}cargarServiciosUsuario(){var i=this;return(0,d.A)(function*(){try{const o=yield i.loginService.obtenerUsuarioAutenticado();o?(i.usuarioAutenticado=o,i.servicios=yield i.loginService.obtenerServicios(),i.filtrarServiciosActivos()):console.error("No hay un usuario autenticado.")}catch(o){console.error("Error al cargar servicios:",o)}})()}iniciarViaje(i){i.todosAceptaron?(i.enCurso=!0,this.loginService.actualizarServicio(i).then(()=>{console.log("El viaje ha comenzado."),alert("El viaje ha sido iniciado exitosamente."),this.navController.navigateBack("/home",{queryParams:{viajeEnCurso:i.id}})}).catch(o=>{console.error("Error al iniciar el viaje:",o)})):alert("No todos los pasajeros han aceptado el viaje.")}aceptarViaje(i,o){const c=i.pasajeros.find(l=>l.usuario===o);c&&(c.acepto=!0,this.loginService.actualizarServicio(i).then(()=>{console.log(`${o} ha aceptado el viaje.`)}).catch(l=>{console.error("Error al aceptar el viaje:",l)}))}confirmarInicioViaje(i){var o=this;return(0,d.A)(function*(){yield(yield o.alertController.create({header:"Confirmar inicio de viaje",message:"\xbfEst\xe1s seguro de que deseas iniciar este viaje?",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Inicio de viaje cancelado")}},{text:"Iniciar",handler:()=>{o.iniciarViaje(i)}}]})).present()})()}}return(a=r).\u0275fac=function(i){return new(i||a)(e.rXU(S.H),e.rXU(g.q9),e.rXU(n.hG))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-service-status"]],decls:11,vars:2,consts:[["slot","start"],[3,"click"],["name","arrow-back-outline"],[4,"ngFor","ngForOf"],["class","ion-padding",4,"ngIf"],[1,"pasajeros-section"],["lines","none",4,"ngFor","ngForOf"],["expand","block","color","success",3,"click","disabled"],["lines","none"],["slot","start",3,"name","color"],[1,"ion-padding"]],template:function(i,o){1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return o.volver()}),e.nrm(4,"ion-icon",2),e.k0s()(),e.j41(5,"ion-title"),e.EFF(6,"Estado de servicios"),e.k0s()()(),e.j41(7,"ion-content")(8,"ion-list"),e.DNE(9,j,18,13,"ion-item",3),e.k0s(),e.DNE(10,f,3,0,"ion-text",4),e.k0s()),2&i&&(e.R7$(9),e.Y8G("ngForOf",o.serviciosUsuario),e.R7$(),e.Y8G("ngIf",0===o.serviciosUsuario.length))},dependencies:[u.Sq,u.bT,n.Jm,n.QW,n.W9,n.eU,n.iq,n.uz,n.he,n.nf,n.IO,n.BC,n.ai,u.QX]}),r})()}];let E=(()=>{var a;class r{}return(a=r).\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[p.iI.forChild(F),p.iI]}),r})(),P=(()=>{var a;class r{}return(a=r).\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[u.MD,m.YN,n.bv,E]}),r})()}}]);