"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6973],{6973:(y,m,r)=>{r.r(m),r.d(m,{UserAcceptPageModule:()=>P});var p=r(177),g=r(4341),n=r(791),v=r(70),d=r(467);class h{constructor(c,s=!1){this.acepto=!1,this.usuario=c,this.acepto=s}}var e=r(3953),f=r(3067),j=r(3656);function A(t,c){if(1&t){const s=e.RV6();e.j41(0,"ion-item")(1,"ion-label")(2,"h2"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s(),e.j41(8,"p"),e.EFF(9),e.k0s(),e.j41(10,"p"),e.EFF(11),e.k0s(),e.j41(12,"p"),e.EFF(13),e.nI1(14,"number"),e.k0s()(),e.j41(15,"ion-button",5),e.bIt("click",function(){const a=e.eBV(s).$implicit,i=e.XpG();return e.Njj(i.aceptarViaje(a))}),e.EFF(16," Confirmar viaje "),e.k0s()()}if(2&t){const s=c.$implicit,o=e.XpG();e.R7$(3),e.SpI("Sede: ",s.sede,""),e.R7$(2),e.SpI("Conductor: ",s.conductor.usuario,""),e.R7$(2),e.Lme("Veh\xedculo: ",s.vehiculo.marca," ",s.vehiculo.modelo,""),e.R7$(2),e.Lme("Capacidad ocupada: ",s.vehiculo.asientosOcupados," de ",s.vehiculo.capacidadMaxima,""),e.R7$(2),e.SpI("Distancia m\xe1xima: ",s.distanciaMaxima," km"),e.R7$(2),e.SpI("Tiempo restante: ",e.i5U(14,9,s.tiempoRestante,"1.0-0")," minutos"),e.R7$(2),e.Y8G("disabled",!o.puedeAceptarServicio(s))}}function b(t,c){1&t&&(e.j41(0,"ion-text")(1,"p"),e.EFF(2,"Ning\xfan viaje disponible."),e.k0s(),e.j41(3,"p"),e.EFF(4,'Toma un viaje en "Busca transporte" y vuelve para confirmar tu viaje.'),e.k0s()())}const F=[{path:"",component:(()=>{var t;class c{constructor(o,a,i){this.loginService=o,this.navController=a,this.toastController=i,this.serviciosDisponibles=[]}ngOnInit(){var o=this;return(0,d.A)(function*(){yield o.cargarServiciosDisponibles()})()}calcularTiempoRestante(o,a){return o-(Date.now()-a)/6e4}cargarServiciosDisponibles(){var o=this;return(0,d.A)(function*(){try{o.usuarioAutenticado=yield o.loginService.obtenerUsuarioAutenticado();const a=yield o.loginService.obtenerServicios();o.serviciosDisponibles=a.filter(i=>!i.enCurso).map(i=>{const l=o.calcularTiempoRestante(i.minutosAnuncio,i.id);i.pasajeros=i.pasajeros||[];const S=Math.max((i.vehiculo.capacidadMaxima||0)-(i.vehiculo.asientosOcupados||0),0);return{...i,tiempoRestante:Math.max(l,0),capacidadDisponible:S}}).filter(i=>i.tiempoRestante&&i.tiempoRestante>0),console.log("Servicios disponibles con tiempo restante:",o.serviciosDisponibles)}catch(a){console.error("Error al cargar servicios disponibles:",a)}})()}puedeAceptarServicio(o){return o.vehiculo.capacidadMaxima-o.vehiculo.asientosOcupados>0}aceptarViaje(o){var a=this;return(0,d.A)(function*(){try{if(console.log("Servicio seleccionado para aceptar:",o),!a.usuarioAutenticado)return void a.mostrarToast("Usuario no autenticado.","danger");const i=o.vehiculo.capacidadMaxima-o.vehiculo.asientosOcupados;if(console.log(`Capacidad disponible: ${i}`),i<=0)return void a.mostrarToast("No hay asientos disponibles en este viaje.","danger");const l=o.pasajeros.find(u=>u.usuario===a.usuarioAutenticado.usuario);if(l)console.log("El usuario ya es pasajero:",l),l.acepto?a.mostrarToast("Ya has aceptado este viaje.","warning"):(l.acepto=!0,o.vehiculo.ocuparAsiento(),console.log("Estado del servicio despu\xe9s de aceptar (existente):",o));else{const u=new h(a.usuarioAutenticado.usuario,!0);o.pasajeros.push(u),o.vehiculo.ocuparAsiento(),console.log("Estado del servicio despu\xe9s de aceptar (nuevo pasajero):",o)}yield a.loginService.actualizarServicio(o),console.log("Servicio actualizado exitosamente."),a.mostrarToast("Te has unido al viaje exitosamente.","success"),yield a.cargarServiciosDisponibles()}catch{}})()}mostrarToast(o,a){var i=this;return(0,d.A)(function*(){(yield i.toastController.create({message:o,duration:3e3,color:a,position:"bottom"})).present()})()}volver(){this.navController.back()}}return(t=c).\u0275fac=function(o){return new(o||t)(e.rXU(f.H),e.rXU(j.q9),e.rXU(n.K_))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-user-accept"]],decls:11,vars:2,consts:[["slot","start"],[3,"click"],["name","arrow-back-outline"],[4,"ngFor","ngForOf"],[4,"ngIf"],["expand","block","color","primary",3,"click","disabled"]],template:function(o,a){1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return a.volver()}),e.nrm(4,"ion-icon",2),e.k0s()(),e.j41(5,"ion-title"),e.EFF(6,"Aceptar viaje"),e.k0s()()(),e.j41(7,"ion-content")(8,"ion-list"),e.DNE(9,A,17,12,"ion-item",3),e.k0s(),e.DNE(10,b,5,0,"ion-text",4),e.k0s()),2&o&&(e.R7$(9),e.Y8G("ngForOf",a.serviciosDisponibles),e.R7$(),e.Y8G("ngIf",0===a.serviciosDisponibles.length))},dependencies:[p.Sq,p.bT,n.Jm,n.QW,n.W9,n.eU,n.iq,n.uz,n.he,n.nf,n.IO,n.BC,n.ai,p.QX]}),c})()}];let U=(()=>{var t;class c{}return(t=c).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[v.iI.forChild(F),v.iI]}),c})(),P=(()=>{var t;class c{}return(t=c).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[p.MD,g.YN,n.bv,U]}),c})()}}]);